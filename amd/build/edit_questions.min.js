define(["jquery"],function(t){var n={capquizId:0};function i(n,i,a){t.ajax({type:"post",url:"action.php",data:n,success:i,error:a})}function a(t,a,e,r){i({action:"set-default-question-rating",id:n.capquizId,rating:a},e,r)}function e(t,a,e,r){i({action:"set-question-rating",id:n.capquizId,"question-id":t.questionId,rating:a},e,r)}function r(t,n,i){t.data("saving",!0),t.data("dirty",!1);var a=t.next();a.css("color","blue"),n(i,t.val(),function(){!0===t.data("dirty")?r(t,n,i):(a.css("color","green"),t.data("dirty",!1),t.data("saving",!1))},function(){a.css("color","red")})}function u(t){r(t,e,{questionId:t.data("question-id")})}function c(t){r(t,a,null)}function o(n,i){t(document).on("input",n,function(n){var a=t(n.target);!0!==a.data("saving")?i(a):a.data("dirty",!0)})}function d(){t(document).on("click",".capquiz-sortable",function(){!function(n){var i=n.index(),a=n.parent().parent(),e=a.find("tr:gt(0)").toArray().sort(function(n,i){var a=t(n).children("td").eq(0),e=t(i).children("td").eq(0);return parseInt(a.text())-parseInt(e.text())});a.append(e),e=a.find("tr:gt(0)").toArray().sort(function(n,a){var e=t(n).children("td").eq(i),r=t(a).children("td").eq(i),u=e.find(".capquiz-sortable-item"),c=r.find(".capquiz-sortable-item"),o=0===u.length?e.html():0===u.val().length?u.html():u.val(),d=0===c.length?r.html():0===c.val().length?c.html():c.val();return t.isNumeric(o)&&t.isNumeric(d)?o-d:o.toString().localeCompare(d)});var r="true"===a.data("asc");a.data("asc",r?"false":"true");var u=r?"fa-arrow-up":"fa-arrow-down";t.each(a.find(".capquiz-sortable"),function(){t(this).find(".fa").remove()}),n.prepend('<i class="fa '+u+'"></i>'),r||(e=e.reverse()),a.append(e);var c=1;a.find("tr:gt(0)").each(function(){t(this).find("td:first-child").html(c),c++})}(t(this))})}return{initialize:function(i){n.capquizId=i,o(".capquiz-question-rating input",u),o(".capquiz-default-question-rating input",c),t(".capquiz-question-rating-submit-wrapper button").each(function(n,i){t(i).attr("tabindex",-1)}),d()}}});