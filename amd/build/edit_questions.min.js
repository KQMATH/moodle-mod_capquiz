define(["jquery"],function(t){var n={courseModuleId:0};function i(n,i,a){t.ajax({type:"post",url:"action.php",data:n,success:i,error:a})}function a(t,a,e,o){i({action:"set-default-question-rating",id:n.courseModuleId,rating:a},e,o)}function e(t,a,e,o){i({action:"set-question-rating",id:n.courseModuleId,"question-id":t.questionId,rating:a},e,o)}function o(t,n,i){t.data("saving",!0),t.data("dirty",!1);var a=t.next();a.css("color","blue"),n(i,t.val(),function(){!0===t.data("dirty")?o(t,n,i):(a.css("color","green"),t.data("dirty",!1),t.data("saving",!1))},function(){a.css("color","red")})}function r(t){o(t,e,{questionId:t.data("question-id")})}function c(t){o(t,a,null)}function u(n,i){t(document).on("input",n,function(n){var a=t(n.target);!0!==a.data("saving")?i(a):a.data("dirty",!0)})}function d(n){var i=n.index(),a=n.parent().parent(),e=a.find("tr:gt(0)").toArray().sort(function(n,i){var a=t(n).children("td").eq(0),e=t(i).children("td").eq(0);return parseInt(a.text())-parseInt(e.text())});a.append(e),e=a.find("tr:gt(0)").toArray().sort(function(n,a){var e=t(n).children("td").eq(i),o=t(a).children("td").eq(i),r=e.find(".capquiz-sortable-item"),c=o.find(".capquiz-sortable-item"),u=0===r.length?e.html():0===r.val().length?r.html():r.val(),d=0===c.length?o.html():0===c.val().length?c.html():c.val();return t.isNumeric(u)&&t.isNumeric(d)?u-d:u.toString().localeCompare(d)});var o="true"===a.data("asc");a.data("asc",o?"false":"true");var r=o?"fa-arrow-up":"fa-arrow-down";t.each(a.find(".capquiz-sortable"),function(){t(this).find(".fa").remove()}),n.prepend('<i class="fa '+r+'"></i>'),o||(e=e.reverse()),a.append(e);var c=1;a.find("tr:gt(0)").each(function(){t(this).find("td:first-child").html(c),c++})}return{initialize:function(i){n.courseModuleId=i,u(".capquiz-question-rating input",r),u(".capquiz-default-question-rating input",c),t(".capquiz-question-rating-submit-wrapper button").each(function(n,i){t(i).attr("tabindex",-1)}),t(document).on("click",".capquiz-sortable",function(){d(t(this))}),t(".capquiz-sortable-default-asc").each(function(){d(t(this)),d(t(this))}),t(".capquiz-sortable-default-desc").each(function(){d(t(this))}),t(".capquiz-add-selected-questions").on("click",function(){var i="";t("#categoryquestions td input[type=checkbox]:checked").each(function(){i+=t(this).attr("name").slice(1)+","}),t.post("action.php",{action:"add-question",id:n.courseModuleId,"question-id":i},function(){location.reload()})})}}});