{"version":3,"file":"edit_slots.min.js","sources":["../src/edit_slots.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     mod_capquiz\n * @author     Sebastian Gundersen <sebastian@sgundersen.com>\n * @copyright  2024 Norwegian University of Science and Technology (NTNU)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\"use strict\";\n\nimport Ajax from 'core/ajax';\n\nexport const SELECTORS = {\n    questionRating: '.capquiz-question-rating',\n    questionRatingInput: '.capquiz-question-rating input',\n    questionRatingSaveButton: '.capquiz-question-rating-save',\n    questionRatingResetButton: '.capquiz-question-rating-reset',\n};\n\n/**\n * Set question rating.\n *\n * @param {number} courseModuleId\n * @param {number} slotId\n * @param {number} rating\n * @returns {Promise<void>}\n */\nexport const setQuestionRating = (courseModuleId, slotId, rating) => {\n    return Ajax.call([{\n        methodname: 'mod_capquiz_set_question_rating',\n        args: {cmid: courseModuleId, slotid: slotId, rating: rating},\n    }])[0];\n};\n\n/**\n * Initialize.\n *\n * @param {number} courseModuleId\n */\nexport const init = courseModuleId => {\n    window.addEventListener('beforeunload', () => {\n        for (const input of document.querySelectorAll(SELECTORS.questionRatingInput)) {\n            if (input.dataset.dirty === 'yes') {\n                event.preventDefault();\n            }\n        }\n    });\n    document.addEventListener('input', event => {\n        const questionRating = event.target.closest(SELECTORS.questionRating);\n        if (questionRating) {\n            const input = questionRating.querySelector('input');\n            const dirty = input.dataset.initialValue !== input.value;\n            const saveButton = questionRating.querySelector(SELECTORS.questionRatingSaveButton);\n            const resetButton = questionRating.querySelector(SELECTORS.questionRatingResetButton);\n            saveButton.classList.toggle('d-none', !dirty);\n            resetButton.classList.toggle('d-none', !dirty);\n            if (dirty) {\n                input.dataset.dirty = 'yes';\n            } else {\n                input.removeAttribute('data-dirty');\n            }\n        }\n    });\n    document.addEventListener('click', async event => {\n        const saveButton = event.target.closest(SELECTORS.questionRatingSaveButton);\n        if (saveButton) {\n            const questionRating = event.target.closest(SELECTORS.questionRating);\n            const input = questionRating.querySelector(SELECTORS.questionRatingInput);\n            const resetButton = questionRating.querySelector(SELECTORS.questionRatingResetButton);\n            saveButton.disabled = true;\n            resetButton.disabled = true;\n            const newValue = parseFloat(input.value);\n            await setQuestionRating(courseModuleId, parseInt(input.dataset.slotId), newValue);\n            input.dataset.initialValue = input.value;\n            saveButton.classList.add('d-none');\n            resetButton.classList.add('d-none');\n            saveButton.disabled = false;\n            resetButton.disabled = false;\n            input.removeAttribute('data-dirty');\n        }\n        const resetButton = event.target.closest(SELECTORS.questionRatingResetButton);\n        if (resetButton) {\n            const questionRating = event.target.closest(SELECTORS.questionRating);\n            const input = questionRating.querySelector(SELECTORS.questionRatingInput);\n            input.value = input.dataset.initialValue;\n            input.removeAttribute('data-dirty');\n            questionRating.querySelector(SELECTORS.questionRatingSaveButton).classList.add('d-none');\n            resetButton.classList.add('d-none');\n        }\n    });\n};\n"],"names":["SELECTORS","questionRating","questionRatingInput","questionRatingSaveButton","questionRatingResetButton","setQuestionRating","courseModuleId","slotId","rating","Ajax","call","methodname","args","cmid","slotid","window","addEventListener","input","document","querySelectorAll","dataset","dirty","event","preventDefault","target","closest","querySelector","initialValue","value","saveButton","resetButton","classList","toggle","removeAttribute","async","disabled","newValue","parseFloat","parseInt","add"],"mappings":"+QA0BaA,UAAY,CACrBC,eAAgB,2BAChBC,oBAAqB,iCACrBC,yBAA0B,gCAC1BC,0BAA2B,qEAWlBC,kBAAoB,CAACC,eAAgBC,OAAQC,SAC/CC,cAAKC,KAAK,CAAC,CACdC,WAAY,kCACZC,KAAM,CAACC,KAAMP,eAAgBQ,OAAQP,OAAQC,OAAQA,WACrD,8DAQYF,iBAChBS,OAAOC,iBAAiB,gBAAgB,SAC/B,MAAMC,SAASC,SAASC,iBAAiBnB,UAAUE,qBACxB,QAAxBe,MAAMG,QAAQC,OACdC,MAAMC,oBAIlBL,SAASF,iBAAiB,SAASM,cACzBrB,eAAiBqB,MAAME,OAAOC,QAAQzB,UAAUC,mBAClDA,eAAgB,OACVgB,MAAQhB,eAAeyB,cAAc,SACrCL,MAAQJ,MAAMG,QAAQO,eAAiBV,MAAMW,MAC7CC,WAAa5B,eAAeyB,cAAc1B,UAAUG,0BACpD2B,YAAc7B,eAAeyB,cAAc1B,UAAUI,2BAC3DyB,WAAWE,UAAUC,OAAO,UAAWX,OACvCS,YAAYC,UAAUC,OAAO,UAAWX,OACpCA,MACAJ,MAAMG,QAAQC,MAAQ,MAEtBJ,MAAMgB,gBAAgB,kBAIlCf,SAASF,iBAAiB,SAASkB,MAAAA,cACzBL,WAAaP,MAAME,OAAOC,QAAQzB,UAAUG,6BAC9C0B,WAAY,OACN5B,eAAiBqB,MAAME,OAAOC,QAAQzB,UAAUC,gBAChDgB,MAAQhB,eAAeyB,cAAc1B,UAAUE,qBAC/C4B,YAAc7B,eAAeyB,cAAc1B,UAAUI,2BAC3DyB,WAAWM,UAAW,EACtBL,YAAYK,UAAW,QACjBC,SAAWC,WAAWpB,MAAMW,aAC5BvB,kBAAkBC,eAAgBgC,SAASrB,MAAMG,QAAQb,QAAS6B,UACxEnB,MAAMG,QAAQO,aAAeV,MAAMW,MACnCC,WAAWE,UAAUQ,IAAI,UACzBT,YAAYC,UAAUQ,IAAI,UAC1BV,WAAWM,UAAW,EACtBL,YAAYK,UAAW,EACvBlB,MAAMgB,gBAAgB,oBAEpBH,YAAcR,MAAME,OAAOC,QAAQzB,UAAUI,8BAC/C0B,YAAa,OACP7B,eAAiBqB,MAAME,OAAOC,QAAQzB,UAAUC,gBAChDgB,MAAQhB,eAAeyB,cAAc1B,UAAUE,qBACrDe,MAAMW,MAAQX,MAAMG,QAAQO,aAC5BV,MAAMgB,gBAAgB,cACtBhC,eAAeyB,cAAc1B,UAAUG,0BAA0B4B,UAAUQ,IAAI,UAC/ET,YAAYC,UAAUQ,IAAI"}