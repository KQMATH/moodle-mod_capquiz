{"version":3,"sources":["../src/edit_questions.js"],"names":["define","$","parameters","courseModuleId","sendAction","data","onSuccess","onError","ajax","type","url","success","error","sendDefaultQuestionRating","rating","sendQuestionRating","questionId","submitInput","$input","sendInput","$indicator","next","css","val","submitQuestionRating","submitDefaultQuestionRating","registerListener","query","submit","document","on","event","target","isBeingSaved","sortTable","$header","column","index","$table","parent","$rows","find","toArray","sort","rowA","rowB","$colA","children","eq","$colB","parseInt","text","append","$itemA","$itemB","valA","length","html","valB","isNumeric","toString","localeCompare","ascending","iconName","each","remove","prepend","reverse","i","registerSortListener","fixTabIndicesForQuestionRatingInputs","object","attr","listenAddToQuiz","questionIds","slice","post","location","reload","initialize"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package    mod_capquiz\n * @author     Sebastian S. Gundersen <sebastian@sgundersen.com>\n * @copyright  2019 NTNU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function($) {\n\n    var parameters = {\n        courseModuleId: 0,\n    };\n\n    /**\n     * Send an action to the server.\n     * @param data\n     * @param onSuccess\n     * @param onError\n     */\n    function sendAction(data, onSuccess, onError) {\n        $.ajax({\n            type: 'post',\n            url: 'action.php',\n            data: data,\n            success: onSuccess,\n            error: onError\n        });\n    }\n\n    /**\n     * Send the new default rating for the question list to the server.\n     * @param {object} data\n     * @param {number} rating\n     * @param {callback} onSuccess\n     * @param {callback} onError\n     */\n    function sendDefaultQuestionRating(data, rating, onSuccess, onError) {\n        sendAction({\n            'action': 'set-default-question-rating',\n            'id': parameters.courseModuleId,\n            'rating': rating,\n        }, onSuccess, onError);\n    }\n\n    /**\n     * Send the new rating for the question to the server.\n     * @param {object} data\n     * @param {number} rating\n     * @param {callback} onSuccess\n     * @param {callback} onError\n     */\n    function sendQuestionRating(data, rating, onSuccess, onError) {\n        sendAction({\n            'action': 'set-question-rating',\n            'id': parameters.courseModuleId,\n            'question-id': data.questionId,\n            'rating': rating,\n        }, onSuccess, onError);\n    }\n\n    /**\n     * Send the new value, and avoid race condition.\n     * @param {object} $input\n     * @param {callback} sendInput\n     * @param {object} data\n     */\n    function submitInput($input, sendInput, data) {\n        $input.data('saving', true);\n        $input.data('dirty', false);\n        var $indicator = $input.next();\n        $indicator.css('color', 'blue');\n        sendInput(data, $input.val(), function() {\n            if ($input.data('dirty') === true) {\n                submitInput($input, sendInput, data);\n            } else {\n                $indicator.css('color', 'green');\n                $input.data('dirty', false);\n                $input.data('saving', false);\n            }\n        }, function() {\n            $indicator.css('color', 'red');\n        });\n    }\n\n    /**\n     * Send the new rating for the question, and avoid race condition.\n     * @param $input\n     */\n    function submitQuestionRating($input) {\n        submitInput($input, sendQuestionRating, {questionId: $input.data('question-id')});\n    }\n\n    /**\n     * Send the new default rating for the question list, and avoid race condition.\n     * @param $input\n     */\n    function submitDefaultQuestionRating($input) {\n        submitInput($input, sendDefaultQuestionRating, null);\n    }\n\n    /**\n     * Register an input event listener for submission.\n     * @param {string} query\n     * @param {callback} submit\n     */\n    function registerListener(query, submit) {\n        $(document).on('input', query, function(event) {\n            var $input = $(event.target);\n            var isBeingSaved = $input.data('saving');\n            if (isBeingSaved === true) {\n                $input.data('dirty', true);\n                return;\n            }\n            submit($input);\n        });\n    }\n\n    /**\n     * Sorts a table by the respective column based on $header.\n     * It searches for an element of class \"capquiz-sortable-item\" inside the <td>, and if found,\n     * the value attribute is used if it exists. Otherwise, the inner html is used to sort by.\n     *\n     * The <td> tag may not have the item class, as it has no effect on the sorting.\n     * Their children elements are not required to have the class either. The inner html of <td> will be used then.\n     *\n     * The first column in the table must be an index of the row.\n     *\n     * @param $header The header column for which to sort the table by.\n     */\n    function sortTable($header) {\n        var column = $header.index();\n        var $table = $header.parent().parent();\n        var $rows = $table.find('tr:gt(0)').toArray().sort(function (rowA, rowB) {\n            var $colA = $(rowA).children('td').eq(0);\n            var $colB = $(rowB).children('td').eq(0);\n            return parseInt($colA.text()) - parseInt($colB.text());\n        });\n        $table.append($rows);\n        $rows = $table.find('tr:gt(0)').toArray().sort(function (rowA, rowB) {\n            var $colA = $(rowA).children('td').eq(column);\n            var $colB = $(rowB).children('td').eq(column);\n            var $itemA = $colA.find('.capquiz-sortable-item');\n            var $itemB = $colB.find('.capquiz-sortable-item');\n            var valA = ($itemA.length === 0 ? $colA.html() : ($itemA.val().length === 0 ? $itemA.html() : $itemA.val()));\n            var valB = ($itemB.length === 0 ? $colB.html() : ($itemB.val().length === 0 ? $itemB.html() : $itemB.val()));\n            if ($.isNumeric(valA) && $.isNumeric(valB)) {\n                return valA - valB;\n            } else {\n                return valA.toString().localeCompare(valB);\n            }\n        });\n        var ascending = ($table.data('asc') === 'true');\n        $table.data('asc', ascending ? 'false' : 'true');\n        var iconName = (ascending ? 'fa-arrow-up' : 'fa-arrow-down');\n        $.each($table.find('.capquiz-sortable'), function () {\n            $(this).find('.fa').remove();\n        });\n        $header.prepend('<i class=\"fa ' + iconName + '\"></i>');\n        if (!ascending) {\n            $rows = $rows.reverse();\n        }\n        $table.append($rows);\n        var i = 1;\n        $table.find('tr:gt(0)').each(function () {\n            $(this).find('td:first-child').html(i);\n            i++;\n        });\n    }\n\n    /**\n     * Register click event listeners for the sortable table columns.\n     */\n    function registerSortListener() {\n        $(document).on('click', '.capquiz-sortable', function() {\n            sortTable($(this));\n        });\n        $('.capquiz-sortable-default-asc').each(function () {\n            sortTable($(this));\n            sortTable($(this));\n        });\n        $('.capquiz-sortable-default-desc').each(function () {\n            sortTable($(this));\n        });\n    }\n\n    /**\n     * Set the tab indices for the question rating elements to be more user friendly.\n     */\n    function fixTabIndicesForQuestionRatingInputs() {\n        $('.capquiz-question-rating-submit-wrapper button').each(function(index, object) {\n            $(object).attr('tabindex', -1);\n        });\n    }\n\n    /**\n     * Register click event listener for \"Add to quiz\" button.\n     */\n    function listenAddToQuiz() {\n        $('.capquiz-add-selected-questions').on('click', function () {\n            var questionIds = '';\n            $('#categoryquestions td input[type=checkbox]:checked').each(function () {\n                questionIds += $(this).attr('name').slice(1) + ',';\n            });\n            $.post('action.php', {\n                'action': 'add-question',\n                'id': parameters.courseModuleId,\n                'question-id': questionIds,\n            }, function () {\n                location.reload();\n            });\n        });\n    }\n\n    return {\n        initialize: function(courseModuleId) {\n            parameters.courseModuleId = courseModuleId;\n            registerListener('.capquiz-question-rating input', submitQuestionRating);\n            registerListener('.capquiz-default-question-rating input', submitDefaultQuestionRating);\n            fixTabIndicesForQuestionRatingInputs();\n            registerSortListener();\n            listenAddToQuiz();\n        }\n    };\n\n});\n"],"file":"edit_questions.min.js"}